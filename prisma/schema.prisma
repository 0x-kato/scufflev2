// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// User Model
model User {
  user_id         Int       @id @default(autoincrement())
  username        String
  first_name      String
  last_name       String
  registration_date DateTime @default(now())
  password_hash   String
  tipsSent        Tip[]     @relation("tipsSent")
  tipsReceived    Tip[]     @relation("tipsReceived")
  balances        UserBalance[]

  @@map("users")
}

// Tip Model
model Tip {
  tip_id        Int           @id @default(autoincrement())
  sender_id     Int
  receiver_id   Int
  amount        Float
  currency      String
  tip_time      DateTime      @default(now())
  message       String?       // Optional field
  status        String
  history       TipHistory[]
  sender        User          @relation("tipsSent", fields: [sender_id], references: [user_id])
  receiver      User          @relation("tipsReceived", fields: [receiver_id], references: [user_id])

  @@map("tips")
}

// Tip History Model
model TipHistory {
  history_id   Int      @id @default(autoincrement())
  tip_id       Int
  event_type   String
  event_time   DateTime @default(now())
  details      String?
  tip          Tip      @relation(fields: [tip_id], references: [tip_id])
}

// Currency Model
model Currency {
  currency_id    Int           @id @default(autoincrement())
  currency_code  String
  currency_name  String
  balances       UserBalance[]
}

// User Balance Model
model UserBalance {
  balance_id     Int      @id @default(autoincrement())
  user_id        Int
  currency_id    Int
  balance        Float
  last_updated   DateTime @default(now())
  user           User     @relation(fields: [user_id], references: [user_id])
  currency       Currency @relation(fields: [currency_id], references: [currency_id])
}